<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>bitstream.io</title><link href="/" rel="alternate"></link><link href="/feeds/all-en.atom.xml" rel="self"></link><id>/</id><updated>2008-08-09T16:23:00+02:00</updated><entry><title>Adding gphoto support for the Canon 1DS</title><link href="/adding-gphoto-support-for-the-canon-1ds.html" rel="alternate"></link><updated>2008-08-09T16:23:00+02:00</updated><author><name>shag</name></author><id>tag:,2008-08-09:adding-gphoto-support-for-the-canon-1ds.html</id><summary type="html">&lt;p&gt;Canon 1Ds HackiWiki!!&lt;/p&gt;
&lt;h2&gt;2007 Aug 20: Raj and I discovered some interesting stuff!!!&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;606527&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;WINDOZE&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x39&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;CAMERA&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x000004da60a8&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;

&lt;span class="nt"&gt;606554&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;CAMERA&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x39&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;WINDOZE&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffc30000&lt;/span&gt; &lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="nx"&gt;bf2000&lt;/span&gt;
 &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="nx"&gt;a98000e&lt;/span&gt; &lt;span class="mi"&gt;28000000&lt;/span&gt; &lt;span class="mi"&gt;000000&lt;/span&gt;&lt;span class="nx"&gt;ff&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt;

&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;bytes 0-3 are always(?) ffffffff&lt;/li&gt;
&lt;li&gt;bytes 4-7 are always(?) ffffffff&lt;/li&gt;
&lt;li&gt;bytes 8-11 are always ffc30000 -- Shag is willing to bet that this 0xffc3 is the Firewire bus address of 'WINDOZE' ...&lt;ul&gt;
&lt;li&gt;A 16-bit firewire address is divided into two parts. The top 10 bits are the bus ID and the bottom 6 are the node ID. In the case of 0xffc3, the top ten bits are 1063 (base 10), which is a special value meaning 'local bus' (&lt;a href="http://www.linux1394.org/doc/libraw1394/intro1394.html#AEN25"&gt;reference&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;bytes 12-15 [0x04bf2000] is the offset for the S/G list&lt;/li&gt;
&lt;li&gt;byte 17 &amp;amp; mask 0x08: if true, then apparently means 'S/G list' - "counter packet" below byte 17 is 0x90&lt;/li&gt;
&lt;li&gt;byte 19 (base 10) [0xe] above is the number of entries in the "S/G list" ...&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;608909&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;WINDOZE&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x1c&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;CAMERA&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x000004bf2000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0070&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;

&lt;span class="nt"&gt;608951&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;CAMERA&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x1c&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;WINDOZE&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0070&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;fb00000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;b23f050&lt;/span&gt; &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;b48d000&lt;/span&gt;
 &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;afe7000&lt;/span&gt; &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;b468000&lt;/span&gt;
 &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;b449000&lt;/span&gt; &lt;span class="mi"&gt;20000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;b4ba000&lt;/span&gt;
 &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;a3fc000&lt;/span&gt; &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;a3dd000&lt;/span&gt;
 &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;a9de000&lt;/span&gt; &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;b437000&lt;/span&gt;
 &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;b488000&lt;/span&gt; &lt;span class="mi"&gt;10000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;b461000&lt;/span&gt;
 &lt;span class="mi"&gt;20000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;a3ea000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;f500000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;b48e000&lt;/span&gt;

&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;First two bytes are length of transfer; next two bytes apparently are ignored; next four bytes is
address on WINDOZE to transfer to.  After this the JPEG data starts.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;These wacky packets (wackets?) are from a completely different part of the file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;507816&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;CAMERA&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x39&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;WINDOZE&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffc30000&lt;/span&gt; &lt;span class="mi"&gt;172&lt;/span&gt;&lt;span class="nx"&gt;e6380&lt;/span&gt;
 &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="nx"&gt;a90005c&lt;/span&gt; &lt;span class="mi"&gt;28000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="nx"&gt;c000000&lt;/span&gt;

&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Above we see that byte 17 &amp;amp; mask 0x08 is false.  So something is up.  Byte 19 [0x5c] happens to represent the number of bytes in the response packet.  Interesting...&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;521267&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;WINDOZE&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x15&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;CAMERA&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000172e6380&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x005c&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="mi"&gt;10000020&lt;/span&gt; &lt;span class="mi"&gt;42000000&lt;/span&gt; &lt;span class="mi"&gt;02000000&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="nx"&gt;d001022&lt;/span&gt;
 &lt;span class="mi"&gt;42000000&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="nx"&gt;ced2501&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="nx"&gt;e000100&lt;/span&gt;
 &lt;span class="mi"&gt;00010002&lt;/span&gt; &lt;span class="mi"&gt;00030004&lt;/span&gt; &lt;span class="mi"&gt;00050006&lt;/span&gt; &lt;span class="mi"&gt;00070008&lt;/span&gt;
 &lt;span class="mi"&gt;0009000&lt;/span&gt;&lt;span class="nx"&gt;a&lt;/span&gt; &lt;span class="mi"&gt;000&lt;/span&gt;&lt;span class="nx"&gt;b000c&lt;/span&gt; &lt;span class="mi"&gt;000&lt;/span&gt;&lt;span class="nx"&gt;d000e&lt;/span&gt; &lt;span class="mi"&gt;000&lt;/span&gt;&lt;span class="nx"&gt;f0010&lt;/span&gt;
 &lt;span class="mi"&gt;00110012&lt;/span&gt; &lt;span class="mi"&gt;00130014&lt;/span&gt; &lt;span class="mi"&gt;00150200&lt;/span&gt; &lt;span class="nx"&gt;ff0100ff&lt;/span&gt;
 &lt;span class="mi"&gt;0200&lt;/span&gt;&lt;span class="nx"&gt;ff01&lt;/span&gt; &lt;span class="mi"&gt;05&lt;/span&gt;&lt;span class="nx"&gt;ff0200&lt;/span&gt; &lt;span class="nx"&gt;ff0106ff&lt;/span&gt;
&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;What's interesting is that the middle of the packet counts from 0x0001 to 0x0015 in 16-bit words.  Then after that there appear to be six 3-byte strings: 0x0200ff, 0x0100ff, 0x0200ff, 0x0105ff, 0x0106ff.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Okay I'm pretty interested in this 0x5c thing.  That is a magic number that I remember from the gphoto2 Canon USB driver.  0x5c is the number of bytes in a 'release params' data structure from the camera.  Release params are things like shutter speed, ISO, etc.  Let's look at the gphoto2 usb source and see if anything matches up.   I think this picture was captured at ISO 640... (looks at camlibs/canon source) ... let's see, for the EOS 5D, that would be a value of 0x5d, offset 0x1a bytes into the packet .... doh, doesn't match.  false alarm...  XXX Turns out this is because I'm looking in the wrong place!  See below!&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Camera idle loop:&lt;/p&gt;
&lt;p&gt;This sequence occurs every second under Windows.  0xffc3 is WINDOZE, 0xffc0 is CAMERA.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;363034&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x2a&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_quadlet_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xfffff0010810&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000000f&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;
&lt;span class="nt"&gt;363064&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x2a&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;363090&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x38&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x000004da60d0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0008&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;
&lt;span class="nt"&gt;363117&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x38&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0008&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="nx"&gt;da60a8&lt;/span&gt;
&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;363762&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x39&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x000004da60a8&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;
&lt;span class="nt"&gt;363788&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x39&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffc30000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;cf5ed20&lt;/span&gt;
 &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="nx"&gt;a900054&lt;/span&gt; &lt;span class="mi"&gt;03000000&lt;/span&gt; &lt;span class="mi"&gt;54000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt;

&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;364702&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x16&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x00000cf5ed20&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0054&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="mi"&gt;70000900&lt;/span&gt; &lt;span class="mi"&gt;00000058&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;80000000&lt;/span&gt;
 &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt;
 &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt;
 &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt;
 &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt;
 &lt;span class="mi"&gt;00000000&lt;/span&gt;
&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;365127&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0b&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x000900000020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0008&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="mi"&gt;41000000&lt;/span&gt; &lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="nx"&gt;da60a8&lt;/span&gt;
&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;Aha! Byte diff for an F-stop setting change&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;325342&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x09&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_quadlet_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xfffff0010810&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000000f&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;
&lt;span class="nt"&gt;325368&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x09&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;325393&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x38&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x000004da60a8&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0008&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;
&lt;span class="nt"&gt;325419&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x38&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0008&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="nx"&gt;da60d0&lt;/span&gt;
&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;325751&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x39&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x000004da60d0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;
&lt;span class="nt"&gt;325780&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x39&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffc30000&lt;/span&gt; &lt;span class="mi"&gt;0775&lt;/span&gt;&lt;span class="nx"&gt;f480&lt;/span&gt;
 &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="nx"&gt;a900054&lt;/span&gt; &lt;span class="mi"&gt;28000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;54000000&lt;/span&gt;

&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;343041&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x15&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x00000775f480&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0054&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="mi"&gt;10000020&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="nx"&gt;c000000&lt;/span&gt; &lt;span class="mi"&gt;02000000&lt;/span&gt; &lt;span class="mi"&gt;25001022&lt;/span&gt;
 &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="nx"&gt;c000000&lt;/span&gt; &lt;span class="mi"&gt;38&lt;/span&gt;&lt;span class="nx"&gt;e92501&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;a000000&lt;/span&gt;
 &lt;span class="mi"&gt;30000000&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="nx"&gt;ff0100&lt;/span&gt; &lt;span class="mi"&gt;0000&lt;/span&gt;&lt;span class="nx"&gt;ffff&lt;/span&gt; &lt;span class="mi"&gt;04010000&lt;/span&gt;
 &lt;span class="mi"&gt;03020000&lt;/span&gt; &lt;span class="mi"&gt;09030000&lt;/span&gt; &lt;span class="mi"&gt;007&lt;/span&gt;&lt;span class="nx"&gt;f7f7f&lt;/span&gt; &lt;span class="mi"&gt;70005800&lt;/span&gt;
 &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="nx"&gt;d007800&lt;/span&gt; &lt;span class="mi"&gt;0000&lt;/span&gt;&lt;span class="nx"&gt;ff00&lt;/span&gt; &lt;span class="mi"&gt;20005800&lt;/span&gt; &lt;span class="mi"&gt;64006400&lt;/span&gt;
 &lt;span class="mi"&gt;64000100&lt;/span&gt;
&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Take a look at byte 64 [0x2d] in the above packet.  That was with one particular aperture setting -- not sure if it's 4.5 or 5.0.  Diffing this against traffic from changing the wheel back changed byte 64 to 0x2b.  Woo hoo!&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;One other thing from that last aperture wheel setting change.  How did the computer know that the camera settings had changed, and that it should query them?  Take a look at the write_block_request in the idle loop packets above.  Then check this out (scroll down to the write_block_request pkt):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;289212&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x05&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_quadlet_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xfffff0010810&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000000f&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;
&lt;span class="nt"&gt;289242&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x05&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;289269&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x38&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x000004da60a8&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0008&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;
&lt;span class="nt"&gt;289296&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x38&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0008&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;04&lt;/span&gt;&lt;span class="nx"&gt;da60d0&lt;/span&gt;
&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;289881&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x39&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x000004da60d0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_pending&lt;/span&gt;
&lt;span class="nt"&gt;289908&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x39&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;read_block_response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0020&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="nx"&gt;ffc30000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;cf5ed20&lt;/span&gt;
 &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="nx"&gt;a900054&lt;/span&gt; &lt;span class="mi"&gt;03000000&lt;/span&gt; &lt;span class="mi"&gt;54000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt;

&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;span class="nt"&gt;290452&lt;/span&gt;  &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc3&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;tl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x11&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;write_block_request&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0xffc0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;offs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x00000cf5ed20&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data_length&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0054&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;extended_tcode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;0x0000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="cp"&gt;[&lt;/span&gt;
 &lt;span class="mi"&gt;70000900&lt;/span&gt; &lt;span class="mi"&gt;00000058&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;80000000&lt;/span&gt;
 &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;02000000&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;a000000&lt;/span&gt; &lt;span class="mi"&gt;10000000&lt;/span&gt;
 &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="nx"&gt;b000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00000000&lt;/span&gt; &lt;span class="mi"&gt;00845400&lt;/span&gt;
 &lt;span class="nx"&gt;f4ff9500&lt;/span&gt; &lt;span class="nx"&gt;d17b4100&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nx"&gt;f05ffff&lt;/span&gt; &lt;span class="nx"&gt;ffff0106&lt;/span&gt;
 &lt;span class="nx"&gt;ffffffff&lt;/span&gt; &lt;span class="mi"&gt;0102&lt;/span&gt;&lt;span class="nx"&gt;ffff&lt;/span&gt; &lt;span class="nx"&gt;ffff0200&lt;/span&gt; &lt;span class="nx"&gt;ff0100ff&lt;/span&gt;
 &lt;span class="mi"&gt;0200&lt;/span&gt;&lt;span class="nx"&gt;ff01&lt;/span&gt;
&lt;span class="cp"&gt;]&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;ack_complete&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;See all that junk at the end?  I think that's how the computer knows to follow up queries.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Okay, just changed ISO and did the same thing as the aperture thing.  Changed ISO 250 to 320.  Byte 66 changed to 0x7b.  Changed back.  Byte 66 changed to 0x78.  Those two values match exactly with the shutter speed table in gphoto2 camlibs/canon.  Shutter speed offset is 0x1e, and aperture offset is 0x1c in the gphoto USB code; this seems to jive with those defines if we consider the 'start' of the release params payload to start at byte 36 of the packet.&lt;/p&gt;
&lt;p&gt;It's interesting that the capture.log.txt that we took has 0xff for both of these parameters.  Perhaps that is because we took those shots in full-auto mode?&lt;/p&gt;
&lt;p&gt;Anyway, it looks like the magic hex string to search for to find get-release-param commands is '8a900054 28'.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;libraw1394&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I'll bet this is what we'd need to use to start testing these commands out: &lt;a href="http://www.linux1394.org/doc/libraw1394/"&gt;http://www.linux1394.org/doc/libraw1394/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;XXX On the other hand, if this device really just speaks SCSI, then we don't need libraw1394 at all..&lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;Arrrr!&lt;/h2&gt;
&lt;p&gt;&lt;img alt="paul_and_raj_r0xx0rs" src="/static/images/paul_and_raj_r0xx0rs.jpg" /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2&gt;2007 Aug 24: SBP and SCSI and Wireshark oh my&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;SCSI and SBP2&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;So today Raj and shag had an interesting thought.  We noticed that when we plugged in the camera to our Linux box that &lt;a href="http://t10.org/ftp/t10/drafts/sbp2/sbp2r04.pdf"&gt;SBP-2&lt;/a&gt; kicked in and the SCSI layer identified the camera and decided it was a scanner (at least in terms of SCSI).  This made us think, "Selves, what if we nosy'd the Linux-&amp;gt;camera communication upon initial plugin and compared that the communication on the Windows side to see if that was using SBP-2 also?"  So we did.  And guess what?  We found a lot of similar packets!  So now we think that the Canon software is just sending down SCSI commands over SBP-2 over Firewire to get the camera to do things.&lt;/p&gt;
&lt;p&gt;So then the question became, well, how do we snoop SCSI?  And it turns out that we could not find any SCSI snoopers that were not hardware based and therefore cost a gazillion dollars and probably did not have any Firewire ports on them anyway.  ... at least until we discovered that Wireshark nee Ethereal had an interesting thingamabob called packet-scsi.c written by some dude at Cicsoc who probably got paid to write that thing for iSCSI.  but maybe we can use that too!!! all wee need to do is to write something where Wireshark can load up nosy-dump files, then we need to write a dissector thingie for SBP-2 (since that does not appear to exist).  Then in the best of all possible worlds, packet-scsi would then magically parse all of the data.&lt;/p&gt;
&lt;p&gt;yeah.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;So we think we'll also probably have to write a basic Firewire -- really, a nosy-dump file format -- dissector.  The traces we've read look pretty simple so far in terms of commands - there aren't any isochronous transfers, all we should need are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;self id&lt;/li&gt;
&lt;li&gt;bus reset&lt;/li&gt;
&lt;li&gt;{read,write}&lt;em _response=",response"&gt;{quadlet,block}&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;looks like we can pull the format right out of the nosy-dump.c source code, &lt;a href="http://bitplanet.net/"&gt;krh's&lt;/a&gt; structs are really nicely formatted and this should be straightforward.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Wireshark Developer's Guide: &lt;a href="http://www.wireshark.org/download/docs/developer-guide-us.pdf"&gt;PDF&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;p&gt;So to write a new file format importer for Wireshark, one must modify this library that comes with it called Wiretap.  unfortunately the current format of nosy-dump files doesn't have any magic numbers that can be used to identify them, so probably the best thing to do is to prepend some magic number/string with an external tool, and modify nosy-dump to prepend these itself for future revs.&lt;/p&gt;
&lt;h2&gt;2007 Nov 1: nosy-dump file format&lt;/h2&gt;
&lt;p&gt;So the current rev of nosy-dump has a really simple file format: PASCAL strings (basically).  It writes exactly what nosy-dump receives from the kernel: an int, representing the number of bytes to follow, and then writes the bytes.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Hack libpcap instead&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Probably the best thing to do is to hack FireWire sniffing support into libpcap.  libpcap already has Bluetooth and USB sniffing support in it...&lt;/p&gt;
&lt;h2&gt;2007 Late November: adding FireWire support to Wireshark&lt;/h2&gt;
&lt;p&gt;Shelved the libpcap idea for the time being.  Wrote a basic nosydump wiretap reader, and hacked up basic Firewire phy &amp;amp; link protocol dissectors to Wireshark.  Next step is to hack up something for SBP2.&lt;/p&gt;
&lt;p&gt;&lt;img alt="wireshark" src="/static/images/wireshark1.jpg" /&gt;&lt;/p&gt;</summary><category term="gphoto"></category><category term="canon"></category><category term="1DS"></category></entry><entry><title>Adding gphoto support for the Canon 5D</title><link href="/adding-gphoto-support-for-the-canon-5d.html" rel="alternate"></link><updated>2008-08-09T16:23:00+02:00</updated><author><name>raj</name></author><id>tag:,2008-08-09:adding-gphoto-support-for-the-canon-5d.html</id><summary type="html">&lt;h3&gt;gphoto for Canon EOS 5D compilation instructions&lt;/h3&gt;
&lt;h4&gt;you MUST use svn rev 10595 or greater. We tested with 10597&lt;/h4&gt;
&lt;p&gt;Building gphoto on Ubuntu 6.10 (note that default 2.6.17 kernel spinlocks, use custom kernel)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#check out trunk. The checkout will fail when trying to pull the libusb directory&lt;/span&gt;
svn co https://gphoto.svn.sourceforge.net/svnroot/gphoto/trunk gphoto
&lt;span class="nb"&gt;cd &lt;/span&gt;gphoto
&lt;span class="c"&gt;#fix broken checkout:&lt;/span&gt;
svn up bindings/ gphoto2/ gphoto2-manual/ gphotofs/ gphoto-import/ gphoto-suite/ gtkam/ libgphoto2/ m4/ playground/ project-3/ website/

&lt;span class="c"&gt;#build libgphoto2&lt;/span&gt;
&lt;span class="nb"&gt;cd &lt;/span&gt;libgphoto2
autoreconf -is
./configure --with-camlibs&lt;span class="o"&gt;=&lt;/span&gt;canon --prefix&lt;span class="o"&gt;=&lt;/span&gt;/scribe
make
sudo make install

&lt;span class="c"&gt;#build gphoto2&lt;/span&gt;
&lt;span class="nb"&gt;cd&lt;/span&gt; ../gphoto2
autoreconf -is
./configure --with-libgphoto2&lt;span class="o"&gt;=&lt;/span&gt;/scribe --prefix&lt;span class="o"&gt;=&lt;/span&gt;/scribe
make
sudo make install
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;linux kernel issues&lt;/h3&gt;
&lt;p&gt;The kernel used by default in Ubuntu 7.04 (feisty) contains usb autosuspend code. Unfortunately, the Canon EOS 5D does not wake back up properly, which makes capturing images impossible. [[http://lkml.org/lkml/2007/8/16/330|A patch has been submitted]], but until it is accepted, you will have to compile a kernel with USB autosuspend turned off. &lt;strong&gt;Update&lt;/strong&gt;: patch [[http://sourceforge.net/mailarchive/message.php?msg_id=20070822220805.GB30603%40kroah.com|accepted]], should be in 2.6.23 kernel. Instructions on how we compiled the kernel are below.&lt;/p&gt;
&lt;p&gt;The kernel used by default in Ubuntu 6.10 (edgy) contains a bug that causes a spinlock in the jbd layer. This bug will cause a machine to hang in a completely unresponsive state, although you can use a serial console to see assertions firing in jbd. One workaround is to use a newer version of Ubuntu (7.04) with autosuspend turned off. Another is to use ext2 intead of ext3.&lt;/p&gt;
&lt;h4&gt;Compiling a custom linux kernel&lt;/h4&gt;
&lt;p&gt;We copied the .config file for the 2.6.17 kernel used by Ubuntu and slightly modified it to turn off usb autosuspend and include the nvidia sata driver.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# Install kernel build pre-reqs&lt;/span&gt;
sudo apt-get install linux-kernel-devel initrd-tools libncurses-dev

&lt;span class="nb"&gt;cd&lt;/span&gt; ~
mkdir linux
&lt;span class="nb"&gt;cd &lt;/span&gt;linux

&lt;span class="c"&gt;# Download stable kernel tree from www.kernel.org (&amp;#39;F&amp;#39; link)&lt;/span&gt;
wget http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.22.2.tar.bz2

tar xjvf linux-2.6.22.2.tar.bz2

&lt;span class="nb"&gt;cd &lt;/span&gt;linux-2.6.22.2

&lt;span class="c"&gt;# Copy the Ubuntu kernel .config file into your source tree:&lt;/span&gt;
cp /usr/src/linux-headers-2.6.17-12-generic/.config .

&lt;span class="c"&gt;# Update the .config with any new entries between 2.6.17 and the current kernel&lt;/span&gt;
rev
&lt;span class="c"&gt;# (You just want to wail on the ENTER key here to select all of the defaults)&lt;/span&gt;
yes &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; | make oldconfig

&lt;span class="c"&gt;# Edit the .config to disable CONFIG_USB_SUSPEND&lt;/span&gt;
perl -p -i.orig -e &lt;span class="s1"&gt;&amp;#39;s/CONFIG_USB_SUSPEND=y/CONFIG_USB_SUSPEND=n/&amp;#39;&lt;/span&gt; .config

&lt;span class="c"&gt;# Enable the Nvidia SATA driver&lt;/span&gt;
&lt;span class="nb"&gt;echo &lt;/span&gt;&lt;span class="nv"&gt;CONFIG_ATA&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;m &amp;gt;&amp;gt; .config
&lt;span class="nb"&gt;echo &lt;/span&gt;&lt;span class="nv"&gt;CONFIG_ATA_ACPI&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;y &amp;gt;&amp;gt; .config
&lt;span class="nb"&gt;echo &lt;/span&gt;&lt;span class="nv"&gt;CONFIG_SATA_NV&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;m &amp;gt;&amp;gt; .config

&lt;span class="c"&gt;# Build kernel (dual-cpu system)&lt;/span&gt;
make -j3 all

&lt;span class="c"&gt;# Install modules &amp;amp; kernel&lt;/span&gt;
sudo make install modules_install

&lt;span class="c"&gt;# Build the boot-time ramdisk of loadable modules, etc.&lt;/span&gt;
sudo mkinitrd -o /boot/initrd.img-2.6.22.2 2.6.22.2

&lt;span class="c"&gt;# Add grub boot section&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Now edit /boot/grub/menu.lst to add a section for the new kernel&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Install custom linux kernel and new nvidia drivers&lt;/h4&gt;
&lt;p&gt;On homeserver:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; ~pjw
sudo ssh root@host &lt;span class="s1"&gt;&amp;#39;cd /;tar -xjvf -&amp;#39;&lt;/span&gt; &amp;lt; new-kernel.tar.bz2
sudo ssh root@host &lt;span class="s1"&gt;&amp;#39;cd /home/scribe;tar -xzvf -&amp;#39;&lt;/span&gt; &amp;lt; new-kernel-source.tar.gz
scp NVIDIA-Linux-x86-100.14.11-pkg1.run scribe@host:
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now on the scribe node:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo /etc/init.d/gdm stop
sudo sh NVIDIA-Linux-x86-100.14.11-pkg1.run
&lt;/pre&gt;&lt;/div&gt;</summary><category term="gphoto"></category><category term="canon"></category><category term="5D"></category></entry></feed>